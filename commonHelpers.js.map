{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import axios from 'axios';\n\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nconst elements = {\n  form: document.querySelector('.js-form'),\n  button: document.querySelector('.js-button'),\n  input: document.querySelector('input[name=\"searchQuery\"]'),\n  gallery: document.querySelector('.js-gallery'),\n  guard: document.querySelector('.js-guard'),\n};\n\nconst lightbox = new SimpleLightbox('.gallery a');\n\nlet page;\nlet searchValue;\nlet totalResults;\n\nelements.form.addEventListener('submit', handleSubmit);\n\nasync function handleSubmit(event) {\n  event.preventDefault();\n\n  elements.gallery.innerHTML = '';\n  totalResults = 0;\n  page = 1;\n  searchValue = elements.input.value.trim();\n\n  if (searchValue === '') {\n    iziToast.warning({\n      title: 'Warning',\n      message: 'Please, fill the input',\n    });\n\n    return;\n  }\n\n  try {\n    const { hits, totalHits, total } = await searchImages(searchValue, page);\n\n    const markup = createImageMarkup(hits);\n    elements.gallery.insertAdjacentHTML('beforeend', markup);\n\n    totalResults += totalHits;\n    lightbox.refresh();\n    if (total >= totalResults) {\n      observer.observe(elements.guard);\n    }\n    if (hits.length === 0) {\n      iziToast.warning({\n        title: 'Warning',\n        message: `Sorry, there are no images matching your search query. Please try again.`,\n      });\n      return;\n    }\n\n    iziToast.success({\n      title: 'Horray!',\n      message: `We found ${totalHits} images.`,\n    });\n  } catch (e) {\n    console.log(e);\n    iziToast.error({\n      title: 'Error',\n      message: 'Please, try again',\n    });\n  } finally {\n    elements.input.value = '';\n  }\n}\n\nasync function searchImages(value, page) {\n  const BASE_URL = 'https://pixabay.com/api/';\n  const API_KEY = '42206478-925606497870cbb45f2a85a6e';\n\n  const response = await axios.get(BASE_URL, {\n    params: {\n      key: API_KEY,\n      q: value,\n      image_type: 'photo',\n      orientation: 'horizontal',\n      safesearch: true,\n      page: page,\n      per_page: 40,\n    },\n  });\n\n  return response.data;\n}\n\nfunction createImageMarkup(arr) {\n  return arr\n    .map(\n      element => `\n      <a class=\"photo-card\" href=\"${element.largeImageURL}\">\n        <div class=\"image-wrapper\">\n          <img\n            src=\"${element.webformatURL}\"\n            alt=\"${element.tags}\"\n            loading=\"lazy\"\n            class=\"image\"\n          />\n        </div>\n        <div class=\"info\">\n          <p class=\"info-item\">\n            <b>Likes</b>\n            <b> ${element.likes}</b>\n          </p>\n          <p class=\"info-item\"><b>Views</b><b>${element.views}</b></p>\n          <p class=\"info-item\"><b>Comments</b><b>${element.comments}</b></p>\n          <p class=\"info-item\"><b>Downloads</b><b>${element.downloads}</b></p>\n        </div>\n      </a>\n        `\n    )\n    .join('');\n}\n\n// INFINITY SCROLL\nconst options = {\n  root: null,\n  rootMargin: '300px',\n  threshold: 0,\n};\n\nconst observer = new IntersectionObserver(handlerLoadMore, options);\n\nasync function handlerLoadMore(entries, observer) {\n  for (const entry of entries) {\n    if (entry.isIntersecting) {\n      page += 1;\n\n      try {\n        const { hits, totalHits, total } = await searchImages(\n          searchValue,\n          page\n        );\n        const markup = createImageMarkup(hits);\n        elements.gallery.insertAdjacentHTML('beforeend', markup);\n\n        totalResults += totalHits;\n        lightbox.refresh();\n\n        if (total > totalResults) {\n          observer.observe(elements.guard);\n\n          // SMOOTH SCROLL\n\n          const { height: cardHeight } = document\n            .querySelector('.gallery')\n            .firstElementChild.getBoundingClientRect();\n\n          window.scrollBy({\n            top: cardHeight * 2,\n            behavior: 'smooth',\n          });\n        } else {\n          observer.unobserve(elements.guard);\n          iziToast.error({\n            title: 'Error',\n            message: `We're sorry, but you've reached the end of search results.`,\n          });\n        }\n      } catch (e) {\n        console.log(e);\n        iziToast.error({\n          title: 'Error',\n          message: 'Please, try again',\n        });\n      }\n    }\n  }\n}\n\n// LIGHTBOX\n\n// SCROLL TO TOP\nconst scrollToTop = () => {\n  const header = document.getElementById('search-form');\n  const headerOffset = header.offsetTop;\n\n  window.scrollTo({\n    top: headerOffset,\n    behavior: 'smooth',\n  });\n};\ndocument.querySelector('.scroll-to-top').addEventListener('click', scrollToTop);\n"],"names":["elements","lightbox","SimpleLightbox","page","searchValue","totalResults","handleSubmit","event","iziToast","hits","totalHits","total","searchImages","markup","createImageMarkup","observer","value","BASE_URL","API_KEY","axios","arr","element","options","handlerLoadMore","entries","entry","cardHeight","e","scrollToTop","headerOffset"],"mappings":"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"}