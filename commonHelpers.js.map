{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import axios from 'axios';\n\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nconst elements = {\n  form: document.querySelector('.js-form'),\n  button: document.querySelector('.js-button'),\n  input: document.querySelector('input[name=\"searchQuery\"]'),\n  gallery: document.querySelector('.js-gallery'),\n  guard: document.querySelector('.js-guard'),\n};\n\nlet page = 1;\nlet searchValue;\nlet totalResults;\n\nelements.form.addEventListener('submit', handleSubmit);\n\nasync function handleSubmit(event) {\n  event.preventDefault();\n  elements.gallery.innerHTML = '';\n  totalResults = 0;\n\n  searchValue = elements.input.value.trim();\n  if (searchValue === '') {\n    iziToast.warning({\n      title: 'Warning',\n      message: 'Please, fill the input',\n    });\n\n    return;\n  }\n\n  try {\n    const images = await searchImages(searchValue, page);\n    if (images.length === 0) {\n      iziToast.warning({\n        title: 'Warning',\n        message: `Sorry, there are no images matching your search query. Please try again.`,\n      });\n    }\n\n    const markup = createImageMarkup(images);\n\n    elements.gallery.insertAdjacentHTML('beforeend', markup);\n    lightbox.refresh();\n  } catch (e) {\n    iziToast.error({\n      title: 'Error',\n      message: 'Please, try again',\n    });\n  } finally {\n    elements.input.value = '';\n  }\n}\n\nasync function searchImages(value, page) {\n  const BASE_URL = 'https://pixabay.com/api/';\n  const API_KEY = '42206478-925606497870cbb45f2a85a6e';\n\n  const response = await axios.get(BASE_URL, {\n    params: {\n      key: API_KEY,\n      q: value,\n      image_type: 'photo',\n      orientation: 'horizontal',\n      safesearch: true,\n      page: page,\n      per_page: 40,\n    },\n  });\n  if (response.status !== 200) {\n    throw new Error(response.statusText);\n  }\n\n  totalResults += response.data.totalHits;\n\n  if (response.data.total > totalResults) {\n    observer.observe(elements.guard);\n    iziToast.success({\n      title: 'Horray!',\n      message: `We found ${totalResults} images.`,\n    });\n  } else {\n    observer.unobserve(selectors.guard);\n    iziToast.error({\n      title: 'Error',\n      message: `We're sorry, but you've reached the end of search results.`,\n    });\n  }\n\n  return response.data.hits;\n}\n\nfunction createImageMarkup(arr) {\n  return arr\n    .map(\n      element => `\n      <a class=\"photo-card\" href=\"${element.largeImageURL}\">\n        <div class=\"image-wrapper\">\n          <img\n            src=\"${element.webformatURL}\"\n            alt=\"${element.tags}\"\n            loading=\"lazy\"\n            class=\"image\"\n          />\n        </div>\n        <div class=\"info\">\n          <p class=\"info-item\">\n            <b>Likes</b>\n            <b> ${element.likes}</b>\n          </p>\n          <p class=\"info-item\"><b>Views</b><b>${element.views}</b></p>\n          <p class=\"info-item\"><b>Comments</b><b>${element.comments}</b></p>\n          <p class=\"info-item\"><b>Downloads</b><b>${element.downloads}</b></p>\n        </div>\n      </a>\n        `\n    )\n    .join('');\n}\n\n// INFINITY SCROLL\nconst options = {\n  root: null,\n  rootMargin: '300px',\n  threshold: 0,\n};\n\nconst observer = new IntersectionObserver(handlerLoadMore, options);\n\nasync function handlerLoadMore(entries, observer) {\n  entries.forEach(entry => {\n    if (entry.isIntersecting) {\n      page += 1;\n      if (elements.gallery.textContent === '') {\n        observer.unobserve(elements.guard);\n        return;\n      }\n\n      searchImages(searchValue, page).then(data => {\n        const markup = createImageMarkup(data);\n\n        elements.gallery.insertAdjacentHTML('beforeend', markup);\n        lightbox.refresh();\n\n        // SMOOTH SCROLL\n        const { height: cardHeight } = document\n          .querySelector('.gallery')\n          .firstElementChild.getBoundingClientRect();\n\n        window.scrollBy({\n          top: cardHeight * 2,\n          behavior: 'smooth',\n        });\n      });\n    }\n  });\n}\n\n// LIGHTBOX\nconst lightbox = new SimpleLightbox('.gallery a');\n\n// SCROLL TO TOP\nconst scrollToTop = () => {\n  const header = document.getElementById('search-form');\n  const headerOffset = header.offsetTop;\n\n  window.scrollTo({\n    top: headerOffset,\n    behavior: 'smooth',\n  });\n};\ndocument.querySelector('.scroll-to-top').addEventListener('click', scrollToTop);\n"],"names":["elements","page","searchValue","totalResults","handleSubmit","event","iziToast","images","searchImages","markup","createImageMarkup","lightbox","value","BASE_URL","API_KEY","response","axios","observer","arr","element","options","handlerLoadMore","entries","entry","data","cardHeight","SimpleLightbox","scrollToTop","headerOffset"],"mappings":"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"}